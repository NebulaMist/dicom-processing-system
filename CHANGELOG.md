# 更新日志

本文档记录了DICOM医学影像数据处理系统的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范。

## [未发布]

### 新增
- GitHub Actions CI/CD 配置
- 代码覆盖率报告
- 贡献指南和行为准则

## [7.0.0] - 2025-06-30

### 新增
- **SQ序列完整支持**：定长与未定长SQ序列编码
- **DCMDataSequence增强**：重写Encode方法支持嵌套序列
- **文件保存差异化**：DCMFile.Save()支持编码格式选择
- **编码差异测试**：RealLengthDifferenceTest、LengthEncodingComparisonTest
- **SQ特定测试**：SQSpecificTest、SQExtensionTest、SQEncodeTest
- **递归编码传播**：DCMDataSet.Encode正确处理isUndefinedLength参数

### 改进
- **编码一致性**：完整的编码->解码->验证测试流程
- **字节差异分析**：定长vs未定长编码的详细对比工具
- **测试覆盖**：新增15+个测试程序和用例
- **文档完善**：600字项目总结和技术深度说明

### 修复
- 修复DCMDataSet编码时未递归传递isUndefinedLength参数的问题
- 修复SQ序列编码中定界符位置错误的问题
- 修复文件保存时编码格式选择无效的问题

## [6.0.0] - 2025-05-27

### 新增
- **DICOM医学图像显示系统**：基于Swing的完整图像查看器
- **智能元数据解析**：解决字节数组到整数转换问题
- **实时窗宽窗位调节**：标准医学图像显示算法
- **convertToInt()方法**：支持多种DICOM数据格式转换
- **ImageFrame增强**：8位/16位图像格式兼容

### 改进
- **NumberFormatException修复**：完全解决元数据解析错误
- **像素数据兼容**：支持DCMDataElement和byte[]格式
- **用户界面**：专业的医学图像查看体验

## [5.0.0] - 2025-06-01

### 新增
- **VR编码系统重大升级**：完成所有31种VR类的SetValue方法
- **数值类型VR**：UL、US、SL、SS、FL、FD完整实现
- **字符串类型VR**：AE、AS、CS、LO、SH、ST、LT、PN、UI、UT、UC、UR
- **特殊类型VR**：AT、DA、TM、DT标准格式支持
- **二进制类型VR**：OB、OW、OD、OF、OL、UN、SQ复杂结构支持

### 改进
- **自动字节序处理**：根据传输语法自动选择编码格式
- **长度验证**：每种VR类型的标准长度检查
- **填充处理**：DICOM偶数长度要求的自动处理
- **类型转换**：智能输入类型检测和转换

## [4.0.0] - 2025-04-15

### 新增
- **DCMDataSet编码增强**：完整的数据集编码功能
- **DCMElementWrapper类**：流畅的数据设置语法
- **往返测试**：编码解码一致性验证
- **CompleteEncodeTest**：多VR类型编码测试

### 改进
- **Item方法智能化**：支持索引和DICOM标签参数
- **自动VR推断**：根据标签自动确定VR类型
- **元素自动创建**：不存在元素的自动创建和添加

## [3.0.0] - 2025-03-20

### 新增
- **DCMFile完整文件处理**：128字节前导+DICM+文件头+数据集
- **DCMFileMeta文件头处理**：Group 0x0002元素专用处理
- **传输语法自动检测**：根据文件头UID自动切换
- **文件验证机制**：完整的DICOM文件格式验证

### 改进
- **类型安全方法**：所有get方法返回正确数据类型
- **便捷访问**：患者信息、图像参数的快速获取
- **错误处理**：文件格式错误的自动处理

## [2.0.0] - 2025-02-10

### 新增
- **VR享元模式**：31种VR类型的内存优化管理
- **VRFactory工厂**：VR实例的统一创建和复用
- **传输语法系统**：3种主要传输语法支持
- **字节序处理**：大端/小端自动转换

### 改进
- **性能优化**：VR实例共享池减少内存开销
- **缓存管理**：62个实例的高效缓存
- **类型解析**：完整的DICOM数据类型支持

## [1.0.0] - 2025-01-15

### 新增
- **DICOM数据字典**：5249个标准条目支持
- **组合模式数据结构**：DCMDataSet、DCMDataElement
- **基础VR解析**：主要VR类型的解析功能
- **测试驱动开发**：完整的单元测试框架

### 特性
- **字典加载**：classpath资源文件加载
- **数据解析**：基础DICOM数据元素解析
- **模式设计**：组合模式的标准实现

---

## 版本说明

### 版本号格式
遵循语义化版本控制 (SemVer)：`MAJOR.MINOR.PATCH`

- **MAJOR**：不兼容的API修改
- **MINOR**：向后兼容的功能性新增  
- **PATCH**：向后兼容的问题修正

### 变更类型
- **新增**：新功能
- **改进**：对现有功能的改进
- **修复**：bug修复
- **移除**：移除的功能
- **安全**：安全相关修复
